<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <title>Event-Loop Event-Queue</title>
  </head>
  <body>
    <script>
      async function async1() {
        console.log("async1 start"); // 2.1  2  2 // åˆ†æäº†ä¸‰æ¬¡æ‰æ­£ç¡®
        // æ‰§è¡Œå®Œå‡½æ•°, æŠŠç»“æœå°è£…åˆ°Promise é‡Œé¢, è¿™å°±äº§ç”Ÿäº†ä¸€ä¸ªå¾®ä»»åŠ¡
        // ç«‹åˆ»æ‰§è¡Œasync(), ç„¶ååˆ›å»ºä¸€ä¸ªå¾®ä»»åŠ¡
        await async2();
        // å¾®ä»»åŠ¡åŒ…æ‹¬await ä¹‹åçš„ä»£ç 
        console.log("async1 end"); // 2.3  6  6
      }
      async function async2() {
        console.log("async2"); // 2.2  5  3
      }
      console.log("script start"); // 1.0  1  1
      setTimeout(function() {
        console.log("setTimeout"); // 3.0  8  8
      }, 0);
      async1(); // 2.0
      new Promise(function(resolve) {
        // executor æ˜¯ç«‹å³æ‰§è¡Œçš„
        console.log("promise1"); // 4.1  3  4
        // resolve/reject çš„æ—¶å€™åˆ›å»ºå¾®ä»»åŠ¡, å¾®ä»»åŠ¡åŒ…æ‹¬then/catch ä¸­çš„ä»£ç 
        resolve();
      }).then(function() {
        console.log("promise2"); // 4.2  7  7
      });
      console.log("script end"); // 5  4  5
    </script>
  </body>
</html>
<!--
/************
 *ğŸ“ŒPromise
 ************/

 /*
promise å¯¹è±¡æœ‰å†…éƒ¨å±æ€§ï¼š
  state â€”â€” æœ€åˆæ˜¯ â€œpendingâ€ï¼Œç„¶åè¢«æ”¹ä¸º â€œfulfilledâ€ æˆ– â€œrejectedâ€ï¼Œ
  result â€”â€” ä¸€ä¸ªä»»æ„å€¼ï¼Œæœ€åˆæ˜¯ undefinedã€‚
åªèƒ½é€šè¿‡.then/catch æ¥æ”¶, æ— æ³•ç›´æ¥è·å–
*/

/*
  å½“ executor å®Œæˆä»»åŠ¡æ—¶ï¼Œåº”è°ƒç”¨ä¸‹åˆ—ä¹‹ä¸€ï¼š
    resolve(value) â€”â€” è¯´æ˜ä»»åŠ¡å·²ç»å®Œæˆï¼š
      å°†state è®¾ç½®ä¸º "fulfilled"
      å°†result to valueã€‚
        ä¼šè°ƒç”¨then, å¹¶æŠŠå€¼ä¼ ç»™then
        ä½œç”¨å°±æ˜¯ä¿®æ”¹çŠ¶æ€, ç»™then ä¼ å€¼
    reject(error) â€”â€” è¡¨æ˜æœ‰é”™è¯¯å‘ç”Ÿï¼š
      å°†state è®¾ç½®ä¸º "rejected"ï¼Œ
      å°†result è®¾ç½®ä¸º errorã€‚
        ä¼šè°ƒç”¨catch, å¹¶æŠŠå€¼ä¼ ç»™catch
*/
let executor = function(resolve, rejected) {};
new Promise(executor);

// .then æœ‰ä¸¤ä¸ªå‚æ•°
promise.then(
  function(result) { /* handle a successful result */ },
  function(error) { /* handle an error */ }
);
// åªå¯¹then æä¾›ä¸€ä¸ªå‚æ•°æ—¶, è¡¨ç¤ºåªå¯¹æˆåŠŸæ„Ÿå…´è¶£
promise.then(alert);
// åªå¯¹é”™è¯¯æ„Ÿå…´è¶£å¯ä»¥ä½¿ç”¨
promise.then(null, alert)
promise.catch(alert) // .catch(f) æ˜¯.then(null, f) çš„æ¨¡æ‹Ÿ, æ˜¯ç®€å†™, æ˜¯è¯­æ³•ç³–
-->

<!--
/************
 *ğŸ“ŒJavaScript å•çº¿ç¨‹
 ************/
æµè§ˆå™¨æ˜¯å¤šè¿›ç¨‹å¤šçº¿ç¨‹çš„
æŸä¸ªé¡µé¢çš„JS æ‰§è¡Œ, åªä¼šåˆ†é…ä¸€ä¸ªçº¿ç¨‹
-->

<!--
/************
 *ğŸ“Œäº‹ä»¶é˜Ÿåˆ— Event Queue
 ************/
Event Queue
  å¾®ä»»åŠ¡é˜Ÿåˆ— Microtasks queue
    ä¸€èˆ¬ç”±Promise è‡ªåŠ¨æ·»åŠ ä»»åŠ¡, ä¼˜å…ˆçº§é«˜, å¾®ä»»åŠ¡é˜Ÿåˆ—æ¸…ç©ºåæ‰ä¼šæ‰§è¡Œæ¸²æŸ“, ç„¶åæ˜¯å®ä»»åŠ¡
    å¯ä½¿ç”¨ queueMicrotask(f) æ‰‹åŠ¨æ·»åŠ å¾®ä»»åŠ¡
  å®ä»»åŠ¡é˜Ÿåˆ— Macrotask Queue
    å­˜æ”¾ä¸èƒ½ç«‹åˆ»æ‰§è¡Œçš„æ–°ä»»åŠ¡, åŸºæœ¬ä¸Šå›è°ƒéƒ½æ˜¯å®ä»»åŠ¡(å®šæ—¶å™¨å›è°ƒ/äº‹ä»¶å›è°ƒ/Ajax å›è°ƒ)
    å¯ä½¿ç”¨0å»¶è¿Ÿçš„setTimeout(f) æ‰‹åŠ¨æ·»åŠ å®ä»»åŠ¡

å¼‚æ­¥æ‰§è¡Œçš„ä»£ç (å¿…å®šä¼šåŠ å…¥é˜Ÿåˆ—)
  å®šæ—¶å™¨
  Promise
    async/await
    .then/catch/finally

-->

<!--
/************
 *ğŸ“Œäº‹ä»¶å¾ªç¯ Event Loop
 ************/
JavaScript å¼•æ“æœ‰ä¸€ä¸ªçŠ¶æ€å¾ªç¯, å³äº‹ä»¶å¾ªç¯
  ç­‰å¾…ä»»åŠ¡
    æ¯”å¦‚æœ‰å›è°ƒ, ä½†æ˜¯è¿˜æ²¡åˆ°æ‰§è¡Œçš„æ—¶æœº
  æ‰§è¡Œä»»åŠ¡
    è¿™ä¸ªçŠ¶æ€ä¼šé˜»æ­¢æ¸²æŸ“, æ‹†åˆ†è€—æ—¶é•¿çš„ä»»åŠ¡å¾ˆæœ‰å¿…è¦
      æ¯”å¦‚ç¿»è¯‘æ–‡æ¡£
      ç¿»è¯‘100 è¡Œåå°±è®¾ç½®ä¸€ä¸ª0ç§’å®šæ—¶å™¨æŠŠä¸‹ä¸€ä¸ªä¸€ç™¾è¡Œä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—
      ä»¥ä¾¿æœ‰æœºä¼šæ‰§è¡Œå…¶å®ƒä»»åŠ¡
      å¦å¤–, å®šæ—¶å™¨æœ€å°å»¶æ—¶æ˜¯4æ¯«ç§’, å¯ä»¥90è¡Œåå°±è®¾ç½®å®šæ—¶å™¨, ä»¥å…æ²¡æœ‰å…¶ä»–ä»»åŠ¡æ˜¯å¹³ç™½æµªè´¹æ—¶é—´
    è‹¥æ—¶é—´å¤ªä¹…, æµè§ˆå™¨è¿˜ä¼šè­¦ç¤º"é¡µé¢æœªå“åº”"
  ä¼‘çœ (ç©ºé—²)

æ‰§è¡Œæ ˆ/ä¸»æ ˆ æ‰§è¡Œä»»åŠ¡
ä»äº‹ä»¶é˜Ÿåˆ—ä¸­å–ä»»åŠ¡
æ–°ä»»åŠ¡æ”¾å…¥äº‹ä»¶é˜Ÿåˆ—
æ— é™åå¤ä¸Šé¢ä¸‰è€…, å³äº‹ä»¶å¾ªç¯

æ–°ä»»åŠ¡ç¤ºä¾‹
  å¼‚æ­¥ä»£ç å¯ä»¥æ‰§è¡Œå›è°ƒäº†çš„æ—¶å€™
  äº‹ä»¶è§¦å‘åçš„å›è°ƒ
  åŠ è½½äº†å¤–éƒ¨js
-->
