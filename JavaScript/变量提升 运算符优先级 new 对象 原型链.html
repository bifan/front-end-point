<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <title>å˜é‡æå‡ è¿ç®—ç¬¦ä¼˜å…ˆçº§ new å¯¹è±¡ åŸå‹é“¾</title>
  </head>
  <body>
    <script>
      /*********
       * ä»£ç å°šæœªæ‰§è¡Œ
       *********/
      /*
        å˜é‡æå‡ä¼šåœ¨ä»£ç æ‰§è¡Œå‰å¤„ç†var å’Œfunction å¼€å¤´çš„ä»£ç 
        ä¸¤ä¸ªfunction ä¸€ä¸ªvar
          function Foo(){} - å£°æ˜å¹¶å®šä¹‰
          var getName - å£°æ˜å¹¶åˆå§‹åŒ–ä¸ºundefined
          function getName(){} - getName å·²ç»è¢«å£°æ˜è¿‡, åªæ˜¯å®šä¹‰(èµ‹å€¼)getName
        ä»£ç è¿˜æ²¡è¿è¡Œå‰, å†…å­˜ä¸­å·²ç»å¢åŠ ä¸¤ä¸ªå †å†…å­˜äº†
          å‡½æ•°å¯¹è±¡Foo
          å‡½æ•°å¯¹è±¡getName, è¾“å‡º5
      */

      /*********
       * ä»£ç å¼€å§‹æ‰§è¡Œ
       *********/
      /*
        å˜é‡æå‡æ—¶å·²ç»å£°æ˜å®šä¹‰, pass
        global.Foo å‡½æ•°å¹¶æœªè¢«è°ƒç”¨, å‡½æ•°ä½“å¹¶æ²¡æœ‰æ‰§è¡Œ
      */
      function Foo() {
        getName = function() {
          console.log(1);
        };
        return this;
      }
      // ç»™global.Foo (å‡½æ•°å¯¹è±¡)å¢åŠ è¾“å‡º2çš„getName
      Foo.getName = function() {
        console.log(2);
      };
      // ç»™global.Foo.prototype (åŸå‹å¯¹è±¡)å¢åŠ è¾“å‡º3çš„getName
      Foo.prototype.getName = function() {
        console.log(3);
      };
      /*
        åœ¨å˜é‡æå‡é˜¶æ®µ, åªæ‰§è¡Œvar çš„å£°æ˜éƒ¨åˆ†, ç°åœ¨æ‰§è¡Œå®šä¹‰éƒ¨åˆ†
        æŠŠç°æœ‰çš„global.getName è¦†ç›–ä¸ºè¾“å‡º4
      */
      var getName = function() {
        console.log(4);
      };
      // å˜é‡æå‡æ—¶å·²ç»å£°æ˜å®šä¹‰, pass
      function getName() {
        console.log(5);
      }

      /*
        ğŸ–¨ï¸1ï¸âƒ£ è¾“å‡º2 - globalThis.Foo.getName()
        globalThis.Foo æ˜¯æ„é€ å™¨ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡, ä¹Ÿèƒ½æœ‰è‡ªå·±çš„å‡½æ•°
      */
      Foo.getName();

      /*
        ğŸ–¨ï¸2ï¸âƒ£ è¾“å‡º4 - globalThis.getName()
        å˜é‡æå‡æ—¶è¾“å‡º5, ä»£ç æ‰§è¡Œæ—¶åˆè¢«var å®šä¹‰è¦†ç›–ä¸ºè¾“å‡º4
      */
      getName();

      /*
        ğŸ–¨ï¸3ï¸âƒ£ è¾“å‡º1 - globalThis.Foo().getName()
          globalThis.Foo() è¿”å›this
            æ‰§è¡Œå‡½æ•°ä½“ä¸­çš„getName = function(){}
            éšå¼å…¨å±€å˜é‡getName å†æ¬¡è¦†ç›–globalThis.getName, å˜ä¸ºè¾“å‡º1
          å½“å‰this å°±æ˜¯globalThis
          ç„¶åå†æ‰§è¡ŒglobalThis.getName()
      */
      Foo().getName();

      //ğŸ–¨ï¸4ï¸âƒ£ è¾“å‡º1 - globalThis.getName()
      getName();

      /*
        ğŸ–¨ï¸5ï¸âƒ£ è¾“å‡º2
          âœ”ï¸new (Foo.getName)()
            âœ”ï¸ä¼˜å…ˆæ‰§è¡Œæˆå‘˜è®¿é—®
            âœ”ï¸new Foo.getName() ç›¸å½“äºnew Foo.getName
            âœ”ï¸Foo.getName, è¿™ä¸ªå‡½æ•°ä½“ä¼šè¾“å‡º2
            âœ”ï¸new åè¿”å›ä¸€ä¸ªç©ºå¯¹è±¡, ä½†æ˜¯æ²¡æœ‰å˜é‡æ¥æ”¶
          âŒ(new Foo).getName()
          âŒnew (Foo.getName())
      */
      new Foo.getName();

      /*
        ğŸ–¨ï¸6ï¸âƒ£ è¾“å‡º3
          (new Foo()).getName()
          ä½¿ç”¨åŸå‹é“¾ä¸­çš„Foo.prototype.getName è¾“å‡º3
      */
      new Foo().getName();

      /*
        ğŸ–¨ï¸7ï¸âƒ£ è¾“å‡º3
          new ((new Foo()).getName)()
          ç›¸å½“äº new Foo.prototype.getName
      */
      new new Foo().getName();
    </script>
  </body>
</html>
<!--
/*********
* Hosting å˜é‡æå‡
*********/

åœ¨ä»£ç æ‰§è¡Œä¹‹å‰, å¸¦var å’Œfunction çš„ä»£ç , ä¼šæå‰å£°æ˜
function ä¸ä»…æå‰å£°æ˜ä¸”æå‰èµ‹å€¼
var æ˜¯åˆå§‹åŒ–ä¸ºundefined, æ‰§è¡Œåˆ°å…·ä½“ä½ç½®æ—¶èµ‹å€¼

å˜é‡æå‡ç»™å‡ºä¸€ä¸ªå‡è±¡, å˜é‡ä¸ç”¨å£°æ˜å°±å¯ä»¥ä½¿ç”¨, ä½†å…¶å®æ˜¯å› ä¸ºå˜é‡æå‡å£°æ˜è¿‡äº†

let å’Œconst å°±ä¸ä¼šå·å·æå‰å£°æ˜, æ²¡æœ‰ä¸å£°æ˜å°±å¯ä½¿ç”¨çš„å‡è±¡
-->

<!--
/*********
* var å£°æ˜çš„å˜é‡æå‡ç¤ºä¾‹
*********/

function sayHi() {
  phrase = "Hello";
  alert(phrase);
  var phrase;
}
sayHi();

function sayHi() {
  phrase = "Hello"; // (*)
  if (false) {
    var phrase; // var å£°æ˜åªå­˜åœ¨å‡½æ•°ä½œç”¨åŸŸå’Œå…¨å±€ä½œç”¨åŸŸ
  }
  alert(phrase);
}
sayHi();

ä¸Šé¢ä¸¤ä¸ªç­‰åŒäº:
function sayHi() {
  var phrase;
  phrase = "Hello";
  alert(phrase);
}
sayHi();
-->

<!--
/*********
* var æ—¶ä»£, ç”¨å‡½æ•°æ¨¡æ‹Ÿå—çº§ä½œç”¨åŸŸ
*********/

// immediately-invoked function expressionsï¼ŒIIFE
// ç«‹å³è°ƒç”¨å‡½æ•°è¡¨è¾¾å¼
// è¿™æ˜¯å¼€å‘è€…çš„hack å§¿åŠ¿

(function() {
  let message = "Hello";
  alert(message); // Hello
})();

// ç°åœ¨åº”è¯¥ä½¿ç”¨let/const ä»£æ›¿

// ç«‹å³æ‰§è¡Œçš„åŸç†
// æŠŠå‡½æ•°æ”¾åœ¨è¡¨è¾¾å¼ä¸Šä¸‹æ–‡ä¸­æ‰èƒ½ç«‹åˆ»è°ƒç”¨
// æœ‰æ•ˆçš„è¡¨è¾¾å¼ä¸Šä¸‹æ–‡æœ‰
    // (function(){})()
    // (function(){}())
    // !function(){}()
    // +function(){}()
-->

<!--
/*********
* æ·»åŠ å…¨å±€å˜é‡çš„ä¸‰ç§æ–¹å¼
*********/

var x = 1; // declared global, ç”¨var æ˜¾å¼æ·»åŠ 
y = 2; // implied global, ä¸ç”¨ä¿®é¥°ç¬¦éšå¼æ·»åŠ 
window.z = 3; // globalThis.z=3, ç›´æ¥ç»™å…¨å±€å¯¹è±¡æ·»åŠ å±æ€§

// ä¸ä½¿ç”¨ä¿®é¥°ç¬¦å£°æ˜å°±ä½¿ç”¨çš„å˜é‡, ä¼šè‡ªåŠ¨åœ¨globalThis ä¸­åˆ›å»ºæ­¤å±æ€§
function f(){
  y = 100; // éšå¼å…¨å±€å˜é‡
}
f();
globalThis.y // 100

// éšå¼çš„æœºåˆ¶æ˜¯, å¦‚æœå˜é‡ä¸å­˜åœ¨äºå½“å‰ä½œç”¨, åˆ™å‘æ›´å¤§çš„ä½œç”¨åŸŸä¸­æ‰¾, ç›´åˆ°å…¨å±€å¯¹è±¡
// è€Œå…¨å±€å˜é‡ä¸­ä¹Ÿæ²¡æœ‰å°±åˆ›å»ºä¸€ä¸ª
// åªåœ¨æœ‰èµ‹å€¼æ“ä½œæ—¶ä¼šè‡ªåŠ¨åˆ›å»º, ç›´æ¥ä½¿ç”¨ä¸å­˜åœ¨çš„å˜é‡ä¼šæŠ¥é”™
    // (function(){console.log(d+"")})() // ReferenceError: d is not defined

// !!! è¦é˜²æ­¢éšå¼å…¨å±€å˜é‡å‡ºç°, ä¼šæ— æ„ä¸­è¦†ç›–å·²å­˜åœ¨çš„å…¨å±€å˜é‡
globalThis.b = 2;
(function(){
  let a = b = 100; // æ— æ„ä¸­å‡ºç°äº†éšå¼å…¨å±€å˜é‡b
})()
console.log(globalThis.b); // 100, å…¨å±€å˜é‡çš„å€¼è¢«è¦†ç›–
-->

<!--
/*********
* è¿ç®—ç¬¦ä¼˜å…ˆçº§
*********/

20æœ€é«˜, 1æœ€ä½
https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/Operator_Precedence

åœ†æ‹¬å· ä¼˜å…ˆçº§20 ä»å·¦åˆ°å³

æˆå‘˜è®¿é—®(ç‚¹) ä¼˜å…ˆçº§19 ä»å·¦åˆ°å³
new å¸¦æ‹¬å· ä¼˜å…ˆçº§19 ä»å·¦åˆ°å³

new æ— æ‹¬å· ä¼˜å…ˆçº§18 ä»å³åˆ°å·¦
-->
